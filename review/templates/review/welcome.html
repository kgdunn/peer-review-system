
{% extends "review/base.html" %}

{% block content %}

<div class="peer-message-top">{{message}}</div>

<h2>Submission phase</h2>
<p>Submission of your work: allowed from {{pr.dt_submissions_open_up|date:"l, d F Y"}} at {{pr.dt_submissions_open_up|time:"H:i" }} until {{pr.dt_submission_deadline|date:"l, d F Y"}} at {{pr.dt_submission_deadline|time:"H:i" }}

{% if allow_submit %}

<p>You{% if pr.uses_groups %}, or any person in your group,{% endif %} may upload a
file submisison. Only the following file types are accepted: {{pr.accepted_file_types_comma_separated|upper}}.
<p>
<form enctype="multipart/form-data" method="post" action="#">
    {% csrf_token %}
    <input type='hidden' name='learner_ID' value='{{person.user_ID}}' />
    <input type='hidden' name='context_id' value='{{course.label}}'>
    <input type='hidden' name='resource_link_id' value='{{pr.LTI_id}}'>

    {{ file_upload_form }}
    <input type="submit" value="Submit your{% if pr.uses_groups %} group's{% endif %} report" /> (maximum size: {{pr.max_file_upload_size_MB}} MB).
</form>

{% if submission %}
<p>A prior submission was uploaded by you{% if pr.uses_groups %}, or a group member,{% endif %} on {{submission.datetime_submitted|date:"l, d F Y"}} {{submission.datetime_submitted|time:"H:i"}}. You can <a href="{{submission.file_upload.url}}">preview the document</a> (opens in a new tab).
{% endif %}{# submission #}


{% else %}{# if allow_submit #}

<hr>
<h2>Review phase{% if person.role == 'Learn'%}: {{pr.number_of_reviews_per_learner}} peer reviews required{%endif%}</h2>
<p>Start date and time for this review: {{pr.dt_peer_reviews_start_by|date:"l, d F Y"}} at {{pr.dt_peer_reviews_start_by|time:"H:i" }}
<p>You must complete <b>and submit</b> the reviews before: {{pr.dt_peer_reviews_completed_by|date:"l, d F Y"}} at {{pr.dt_peer_reviews_completed_by|time:"H:i" }}

{% if allow_review %}
<div id="accordion" role="tablist" aria-multiselectable="true">
  <div class="card">
{% for item in r_actuals %}
    <div class="card-header" role="tab" id="headingOne">
      <h5 class="mb-0">
        <a data-toggle="collapse"  data-parent="#accordion" href="#collapse_review{{forloop.counter}}" aria-expanded="true" aria-controls="collapse_review{{forloop.counter}}">
          Peer review {{forloop.counter}}{% if person.role != 'Learn'%} [A={{item.submission.number_reviews_assigned}}]{C={{item.submission.number_reviews_completed}}}: {{item.submission.submitted_by.full_name}} {% endif %}
        </a>
      </h5>
    </div>
    <div id="collapse_review{{forloop.counter}}"  role="tabpanel" aria-labelledby="headingOne">
      <div class="card-block">
        <p>Please <a href="/review/{{item.unique_code}}/" target="_blank">access this peer review here</a> (opens in a new tab)

        {% if item.submitted %}<p>You have already reviewed this. <em>Thanks!</em>{% else %}.{%endif%}

      </div>
    </div>
{% endfor %}
  </div>
</div>
{% else %} {# if allow_review #}
<p>No reviews can be done at this time.
{% endif %}

<hr>
<h2>Feedback phase</h2>
<!--Feedback from your peers is available after: {{pr.dt_peer_reviews_received_back|date:"l, d F Y"}} at {{pr.dt_peer_reviews_received_back|time:"H:i" }}-->

{% if allow_report %}
{% if report__n_reviews == 0 %}
<p>There is no feedback, as you did not submit work for the peer review.
{% else %}

<p>You were evaluated by {{report__n_reviews}} peers.

<ul>

{% for item, value in report %}
<li>Average score for criterion {{item}}: {{value.avg_score|floatformat}} out of {{value.max_score|floatformat}} points. (raw data from your peers: {{value.raw}})
{% endfor %}
</ul>
Comments and feedback from your peers are in anonymized, randomized order:
<ul>
{% for commentitem in report__comments %}
<li>{{commentitem}}
{% endfor %}
</ul>
<hr>
Overall score: {{report__learner_avg|floatformat}} out of a maximum of {{report__overall_max_score|floatformat}} points
<hr>


{% endif %} {# report__n_reviews == 0 #}

{% else %}
<p>No feedback is available at this time.
{% endif %} {# allow_report #}

{% endif %}{# if allow_submit #}


{% endblock %}



