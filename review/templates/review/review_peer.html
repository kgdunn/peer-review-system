{% extends "review/base.html" %}
{% block content %}
<style>
body {
	font-size: 11pt;
}

/* Header styles */
#header {
    clear:both;
    float:left;
    width:100%;
}
#header {
    border-bottom:1px solid #000;
}
#header p,
#header h1,
#header h2 {
    padding:.4em 15px 0 15px;
    margin:0;
}

/* 'widths' sub menu */
#layoutdims {
    clear:both;
    background:#eee;
    border-top:4px solid #000;
    margin:0;
    padding:6px 15px !important;
    text-align:right;
}
/* column container */
.colmask {
    position:relative;	    /* This fixes the IE7 overflow hidden bug */
    clear:both;
    float:left;
    width:100%;			    /* width of whole page */
    overflow:hidden;		/* This chops off any overhanging divs */
}
/* common column settings */
.colright,
.colmid,
.colleft {
    float:left;
    width:100%;
    position:relative;
}
.col1,
.col2,
.col3 {
    float:left;
    position:relative;
    padding:0 0 1em 0;
    overflow:hidden;
}
/* 2 Column (right menu) settings */
.rightmenu {
    background:#eee;		/* right column background colour */
}
.rightmenu .colleft {
    right:36%;			    /* right column width */
    background:#fff;		/* left column background colour */
}
.rightmenu .col1 {
    width:65%;			    /* 65-2-2: left column content width (left column width minus left and right padding) */
    left:35%;			    /* 35+2(right column width) plus (left column left padding) */
}
.rightmenu .col2 {
    width:35%;			    /* 35-2-2: right column content width (right column width minus left and right padding) */
    left:35%;			    /* 35+(2+1)+1: (right column width) plus (left column left and right padding) plus (right column left padding) */
	height:84%;
	overflow : auto;
}
/* Footer styles */
#footer {
    clear:both;
    float:left;
    width:100%;
    border-top:1px solid #000;
}
#footer p {
    padding:10px;
    margin:0;
}

.even{
	background:#ccc;
}
.odd{
	background:#ddd;
}
.submit_button{
  display: table;
  margin: auto;
}
p{
margin: 0;

}
.clear {clear: both;}
.radio_text {
  display: block;
  margin-top: -20px;
  margin-left: 28px;
}
.radio_button{
  margin-left: 5px;
}
textarea
{
  width:100%;
}
.textwrapper
{
  border:1px solid #999999;
  margin:5px 0;
  padding:3px;
}
</style>

<div id="header">
	<div class="review-realtime">
	</div>
    <h2>Hello {{person.full_name}}</h2>
	{% if show_feedback %}
		Your report is shown below, with the review from {{report.n_reviews}} reviewers. If this is a self-review, then some of the comments and scores are your own. Your score is {{report.learner_average}}
	{% else %}
        <p>The work you are required to review is shown below. <span style="color: orange">Please open links in the peer review carefully, in a new tab, to prevent loss of your review feedback.</span>
	{% endif %}
	<br>If you do not see any document here then you should please <a href="/{{submission.file_upload.url}}" target="_blank">first download it</a>, and then continue below.
</div>

<div class="colmask rightmenu">
    <div class="colleft">
        <div class="col1">
            <!-- Column 1 start -->
            <object data="/{{submission.file_upload.url}}" type="application/pdf"
                width="100%" height="84%">
                alt : <a href="/{{submission.file_upload.url}}">Peer review document</a>
            </object>
            <!-- Column 1 end -->
        </div>
        <div class="col2">
            <!-- Column 2 start -->

		{% spaceless %}
	    {% if not show_feedback %}
			{{rubric.general_instructions|safe}}<br>
		    Assess the work based on these criteria. Submit your review when complete.
		    <form action="{% url 'submit_peer_review_feedback' ractual_code=ractual_code %}"
		          method="POST" enctype="multipart/form-data">{% csrf_token %}
		    <div class="submit_button" ><input  type="submit" name="{{ractual_code}}" value="Submit your review"></div>
			<hr>
		{% endif %}
		<div class="clear"></div>

            {% for item in r_item_actuals %} {# This alternates the major ITEMS in the rubric #}
				<fieldset id="fieldset-item-{{item.ritem_template.order}}" class="{% cycle 'odd' 'even' %}">
				{# Criterion is given here #}
                {% if rubric.show_order %}{{item.ritem_template.order}}. {% endif %}
				{{item.ritem_template.criterion|safe}} <span style="float:right; margin-bottom:10px">(maximum score: <b>{{item.ritem_template.max_score|floatformat}} point{{item.ritem_template.max_score|pluralize}}</b>)</span>
				<hr>

                {% for option in item.options %}
					{% if item.ritem_template.option_type == 'Radio' %}
                    <div class="radio">
                        <label><span class="radio_button peeroption"><input type="radio" name="item-{{item.ritem_template.order}}" value="option-{{option.order}}"></span><span class="radio_text"><b>{{option.score|floatformat}} point{{option.score|pluralize}}</b>: {{option.criterion|safe}} </span></label>
                    </div>
					{% endif %}
					{% if item.ritem_template.option_type == 'DropD' %}
					   {% if option.criterion %}
                           <ul><b>{{option.score|floatformat}} point{{option.score|pluralize}}</b>: {{option.criterion|safe}}</ul>
					   {% endif %}
					{% endif %}
					{% if item.ritem_template.option_type == 'LText' %}
						<div  class="LText" style="display: block;" id="item-{{item.ritem_template.order}}">
						    <label for="item-{{item.ritem_template.order}}" id="item-{{item.ritem_template.order}}"></label>
						    {% if show_feedback %}
							    The feedback you received was:
						        <div class="textwrapper">
									<textarea cols="2" rows="10" name="item-{{item.ritem_template.order}}" readonly>{{item.results.0}}</textarea>
								</div>
							{% else %}
							    <div class="textwrapper">
									<textarea cols="2" rows="10" name="item-{{item.ritem_template.order}}" placeholder="{{option.criterion}}">{{option.prior_text}}</textarea>
								</div>
							{% endif %}

						</div>
					{% endif %}
                {% endfor %} {#for: option in item.options #}
				{% if show_feedback %} {# show peer/self feedback #}
				    {% if item.ritem_template.option_type == 'LText' %}{% endif%}
				    {% if item.ritem_template.option_type == 'DropD' %}
					    <em>Peer scores</em>:
					    {{item.results.0}}; average = {{item.results.2|floatformat}}
					{% endif %}
				{% else %}
				    {%if item.ritem_template.option_type == 'DropD'%}
					<div class="dropdown-score" style="padding:	10px">
					Your evaluation:
					<select id="item-{{item.ritem_template.order}}" name="item-{{item.ritem_template.order}}" required>
					<option value="option-NA" selected disabled>Based on the above descriptions, please give a score ...</option>
						{% for option in item.options %}
							<option class="peeroption" value="option-{{option.order}}"{%if option.selected%} selected="selected"{% endif %}>{{option.score|floatformat}} point{{option.score|pluralize}}</option>
						{% endfor %}
					</select>
					</div>
				    {% endif %} {#item.ritem_template.option_type#}
				{% endif %} {# ``show_feedback``: show peer/self feedback #}


				</fieldset>
            <hr>
            {% endfor %}
		{% if not show_feedback %}
			<span class="submit_button" ><input type="submit" name="below-{{ractual_code}}" value="Submit your review"></span>
			</form>
		{% endif %}
		{% endspaceless %}
            <!-- Column 2 end -->
        </div>
    </div>
</div>

<div id="footer">
</div>

{% endblock %}
{% block footer %}

<script>

$( "select" ).change(function (event) {

	//$( "#header" ).text( str );
	var postdata = {'csrfmiddlewaretoken': '{{ csrf_token }}',
	                'option': event.target.value,
					'item': event.target.id};

	$.ajax({
		method: "POST",
		url: '{% url 'xhr_store' ractual_code=ractual_code %}',
		data: postdata,
		dataType: 'json',
		cache: false,
		success: function(result) {$('#XHRdiv').html(result);},
		error: function (response, desc, exception) {// custom error
		}
	}).done(function( msg ) {

  });


}).change();

</script>
{% endblock %}